{% extends "base.html" %}
{% block head %}
<link href="{{ url_for('static', filename='css/account.css') }}" rel="stylesheet">
{% endblock head%}

{% block content %}
<div class="div-tabs">
    <ul class="nav nav-tabs">
        <li class="nav-item"><a class="nav-link active" href="#usuario" data-toggle="tab">Usuário</a></li>
        <li class="nav-item"><a class="nav-link" href="#assinatura" data-toggle="tab">Assinatura</a></li>
        <li class="nav-item"><a class="nav-link" id="tab-integracoes" href="#integracoes" data-toggle="tab">Integrações</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="usuario">
            <form method="POST" action="" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                <fieldset class="form-group">
                    <div class="mb-3">
                        {{ form.username.label(class="form-control-label") }}
                        {% if form.username.errors %}
                            {{ form.username(class="form-control form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.username.errors %}
                                    <span> {{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.username(class="form-control form-control") }}
                        {% endif %}
                        
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                {{ form.cpf.label(class="form-control-label") }}
                                {% if form.cpf.errors %}
                                    {{ form.cpf(class="form-control is-invalid", id="cpf") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.cpf.errors %}
                                            <span> {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.cpf(class="form-control", id="cpf") }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="mb-3">
                                {{ form.celular.label(class="form-control-label") }}
                                {% if form.celular.errors %}
                                    {{ form.celular(class="form-control is-invalid", id="celular") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.celular.errors %}
                                            <span> {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.celular(class="form-control", id="celular") }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        {{ form.email.label(class="form-control-label", readonly="readonly") }}
                        {% if form.email.errors %}
                            {{ form.email(class="form-control form-control is-invalid", readonly="readonly") }}
                            <div class="invalid-feedback">
                                {% for error in form.email.errors %}
                                    <span> {{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.email(class="form-control form-control", readonly="readonly") }}
                        {% endif %}
                    </div>
                </fieldset>
                <div class="me-2 mb-2">
                    <p class="dica">Dica: Mantenha seus sempre dados atualizados</p>          
                </div>          
                <div class="me-2 mb-5">
                    {{ form.submit(class="btn-sm btn-general me-2") }}
                </div>
            </form> 
            <form method="POST" action="" enctype="multipart/form-data">
                {{ form2.hidden_tag() }}
                <fieldset class="form-group">
                    <p>Altere sua senha e mantenha sua conta protegida</p>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                {{ form2.old_password.label(class="form-control-label") }}
                                {% if form2.old_password.errors %}
                                    {{ form2.old_password(class="form-control is-invalid", id="old_password") }}
                                    <div class="invalid-feedback">
                                        {% for error in form2.old_password.errors %}
                                            <span> {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form2.old_password(class="form-control", id="old_password") }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="mb-3">
                                {{ form2.new_password.label(class="form-control-label") }}
                                {% if form2.new_password.errors %}
                                    {{ form2.new_password(class="form-control is-invalid", id="new_password") }}
                                    <div class="invalid-feedback">
                                        {% for error in form2.new_password.errors %}
                                            <span> {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form2.new_password(class="form-control", id="new_password") }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="mb-3">
                                {{ form2.confirm_new_password.label(class="form-control-label") }}
                                {% if form2.confirm_new_password.errors %}
                                    {{ form2.confirm_new_password(class="form-control is-invalid", id="confirm_new_password") }}
                                    <div class="invalid-feedback">
                                        {% for error in form2.confirm_new_password.errors %}
                                            <span> {{ error }}</span>
                                        {% endfor %}
                                    </div>
                                    {% else %}
                                    {{ form2.confirm_new_password(class="form-control", id="confirm_new_password") }}
                                    {% endif %}
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div class="me-2 mb-5">
                    {{ form2.submit2(class="btn-sm btn-general me-2") }}
                </div>
            </form> 
        </div>
        <div class="tab-pane fade" id="integracoes">
            <div class="content-section">
                <h4>WooCommerce</h4>
                <div class="woo-commerce-form mt-3">
                  <form method="POST" id="woo-commerce-form" action="">
                    <div class="mb-3">
                      <label for="wooCommerceURLInput" class="form-label">URL da loja</label>
                      <input type="url" class="form-control" required id="wooCommerceURLInput" name="woo_url" placeholder="https://www.meuecommerce.com.br">                  
                    </div>
                    <div class="mb-3">
                      <label for="wooCommerceKeyInput" class="form-label">Chave da API</label>
                      <input type="text" class="form-control" required id="wooCommerceKeyInput" name="woo_key" placeholder="ck_...">                      
                    </div>
                    <label for="wooCommerceSecretInput" class="form-label">Secret da API</label>
                    <div class="input-group mb-3">
                      <input type="password" class="form-control" required name="woo_secret" id="wooCommerceSecretInput" placeholder="cs_...">
                      <button type="button" class="btn-sm btn-outline-secondary" style="border-top-right-radius: 5px;border-bottom-right-radius: 5px;" id="button-see-pass" onclick="showWooPassword()"><i class="fas fa-eye"></i></button>
                    </div>
                    <div class="text-center">
                        <div  class="mb-2">
                            <p id='woo-response'>
                            </p>
                        </div>
                        <div class="d-flex justify-content-center">
                            <a href="javascript:void(0)" class="btn-sm btn-general-2 m-3" id="salvar-btn">Salvar </a>
                            <a href="javascript:void(0)" class="btn-sm btn-general-2 m-3" id="salvar-disabled-btn">Salvar <span class="spinner-border spinner-border-sm" id="register-spinner" role="status" aria-hidden="true"></span></a>
                            <a href="javascript:void(0)" class="btn-sm btn-general m-3" id="checar-btn">Checar conexão </a>
                            <a href="javascript:void(0)" class="btn-sm btn-general m-3" id="checar-disabled-btn">Checar conexão <span class="spinner-border spinner-border-sm" id="register-spinner" role="status" aria-hidden="true"></span></a>
                        </div>
                    </div>
                  </form>
                  <p class="text-muted text-center">
                    Não sabe a chave e o secret do seu WooCommerce? 
                    <a href="https://woocommerce.github.io/woocommerce-rest-api-docs/?python#rest-api-keys" target="_blank">Clique aqui</a>
                     e siga as instruções
                  </p>
                  <div class="border-top pt-3">   
                  </div>
                </div>
              </div>
        </div>
        <div class="tab-pane fade" id="assinatura">
            {% if customer_info.status=='active' or customer_info.status=='trialing' %}
                <div class="div-plano mb-2">
                    <h4 class="alert-heading">{{ customer_info.plan }}</h4>
                    <p>Sua assinatura encontra-se ATIVA.</p>
                    <hr>
                    <p class="mb-0">Assinado em: {{ customer_info.start_date }} </p>
                    <hr>
                    <p class="mb-0">Vencimento: {{ customer_info.current_period_end }} </p>
                    {% if customer_info.cancel_at_period_end == False %}
                        <p class="fs-8 mb-0">Renovação automática</p>
                    {% endif %}
                    <hr>
                    <p id="plan_cost" class="mb-0">{{ customer_info.amount }}</p>
                </div>
                {% if customer_info.cancel_at_period_end == True %}
                    <div class="alert alert-warning" role="alert">
                        <p class="mb-0 text-bold">Renovação automática cancelada.</p>
                        <p class="mb-0">A partir de {{ customer_info.current_period_end }} sua inscrição será cancelada e você não poderá criar novas artes.</p>
                        <p class="mb-0">As cobranças estão suspensas para essa conta.</p>
                    </div>  
                    <div>
                        <p>Mudou de ideia? Clique no botão abaixo e reative sua conta sem cobranças extras.</p>
                        <a class="btn-sm btn-general btn-reativar" href="{{ url_for('payments.reactivate_subscription') }}">Reativar renovação automática</a>
                    </div>   
                {% else %}               
                    <div class="mt-3">
                        <a class="btn-sm btn-general-cancel" href="{{ url_for('payments.cancel_subscription') }}">Cancelar</a>
                        <a class="btn-sm btn-general me-2" href="{{ url_for('payments.customer_portal') }}">Editar Assinatura</a>
                    </div>
                {% endif %}

            {% else %}
                <div class="alert alert-warning" role="alert">
                    <h4 class="alert-heading">Que pena!</h4>
                    <hr>
                    <p>Não encontramos planos ativos para seu usuário. Se inscreva e teste grátis nossa ferramenta por 30 dias.</p>
                    <p>Se não gostar é só cancelar sem custos, ok?</p>
                    <a class="btn btn-outline-secondary me-2" href="{{ url_for('payments.subscribe') }}">Assinar</a>                        
                </div>                
            {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block footer %}
<script src="{{ url_for('static', filename='js/account.js') }}" type="text/javascript"></script>
{%endblock footer %}